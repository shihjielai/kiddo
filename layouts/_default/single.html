<!-- <html>
<head>
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <meta http-equiv="X-UA-Compatible" content="ie=edge">
     <title>Document</title>
</head>
<body>

     {{ partial "header" (dict "Kind" .Kind "Template" "Single") }}
     <div style="margin:25px;">
          <h1>{{.Title}}</h1>
          <div style="color:grey; font-size:16px;">{{ dateFormat "Monday, Jan 2, 2006" .Date }}</div>
          <div style="color:grey; font-size:16px;">{{if .Params.author}}Author: {{.Params.Author}}{{end}}</div>
          <div style="font-size:18px;">{{.Content}}</div>
     </div>
     {{$title := .Title}}
     {{with (index .Site.Data .File.TranslationBaseName)}}
          {{$prefix := .urlPrefix}}
          {{$publication := .publication}}
          {{range .cds}}
               {{$cd := .cd}}
               <h2 style="background-color: brown; color: white">{{.cd}}</h2>
               {{range .tracks}}
                    {{range $i, $sequence := (seq .startTrack .endTrack)}}
                         <div style="background-color:bisque">
                              <h3>title: {{printf "Track %02d" $sequence}}</h3>
                              {{$uniqueFilename := (print $publication "-" $cd "-" (printf "track%02d" $sequence))}}
                              <h3>url: {{print $prefix (md5 $uniqueFilename) ".mp3"}}</h3>
                         </div>
                    {{end}}
               {{end}}
          {{end}}
     {{end}}
     <h3>{{$title}}</h3>
    
     {{ partial "footer" . }}
</body>
</html> -->



<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex">
    <meta name="googlebot" content="noindex,nofollow">
    <title>Document</title>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@700&display=swap" rel="stylesheet">
    <style type="text/css">
    .header-nav {
        height:15%;
        width: 100%;
        background-image: url("/images/top_bg.png") ;
        background-repeat: no-repeat;
        background-color: rgb(96, 221, 240);
        background-position: right bottom;
    }

    .header-player {
   background-color: rgb(248,248,255);
    }
    section.main{
        height:100px;
        /* background-color:#e4e4e4;   */
     
        flex-grow:1;  /*充滿剩餘的空間*/
        overflow-y: auto;
    }

    footer {
        height:7%;
        background-color: rgb(59, 125, 185);
       
        box-shadow:2px 2px 5px cadetblue;
    }
    body{
        display: flex;
        flex-direction: column;
        margin:0;
        height:100vh;
        font-family: 'Noto Sans JP', sans-serif;
    }
    .paper{
        padding:2rem;
        background-color: white;
        margin:1em;
        box-shadow: 2px 2px 5px grey;
    }
    .cdPages {
     display: flex;
     justify-content:flex-start;
     height: 50px;
     background-color: #ffffff;
 
    }
    #CD1{

        width: 25%;
        background-color:rgb(241, 151, 0);
        display: flex;
        justify-content: center;
        align-items:center;
        color:#ffffff;
        font-size: 25px;
        margin-left:15px;
        border-radius: 10%;
        box-shadow:2px 2px 2px darkorange;
    }
    #CD2{
    
        width: 25%;
        background-color:rgb(213, 226, 238);
        display: flex;
        justify-content: center;
        align-items:center;
        color:#666666;
        font-size: 25px;
        margin-left:15px;
        border-radius: 10%;
        box-shadow:2px 2px 2px rgb(177, 196, 173);
     
    }
    .header-player{
        
 
 
  
    }
    @media (min-width: 1199px) and (max-width: 1920px){
      header.header-player{
        width: 992px;
      }
      #CD1, #CD2{
        width: 116px;
      }
      section.paper, section.main {
        width: 992px;
      }
    }
    @media screen and (max-width: 1199px){
      header.header-player{
        width: 930px;
      }
      #CD1, #CD2{
        width:118.25px;
      }
      section.paper, section.main {
        width: 930px;
      }
    }
    @media screen and (max-width: 991px){
      header.header-player{
        width: 768px;
      }
      #CD1, #CD2{
        width:120.5px;
      }
      section.paper, section.main {
        width: 768px;
      }
    }
    @media screen and (max-width: 767px){
      header.header-player {
        width: 576px;
      }
      #CD1, #CD2{
        width:122.75px;
      }
      section.paper, section.main {
        width: 576px;
      }
    }
    @media screen and (max-width: 575px){
      header.header-player{
        width: 435px;
      }
      #CD1, #CD2{
        width: 125px;
      }
      section.paper{
        width: 435px;
        margin-left: 50px;
      }
      section.main {
        width: 435px;
      }
    }

    /* playlist的部分 */
 
    .active a{
      color:#c49b2c;
      text-decoration:none;
    }
    li a{
      color:#371c50;
      padding:5px;
      display:block;
      text-decoration:none;
    }
    li a:hover{
      text-decoration:none;
    }
    a:hover{
      cursor: pointer;
    }
    #playlist li.active{
      background-color:chocolate;
    }
    </style>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    
<body>
    <header class="header-nav">
      {{with (index .Site.Data .File.TranslationBaseName)}}
        <img src="{{.VolumeImage}}" alt="" style="width:20%">
        {{end}}
    </header>
    <!-- <div class="cdPages">
        <div id="CD1">CD1</div>
        <div id="CD2">CD2</div>
    </div> -->


    <header class="header-player" style="display: inline-block;justify-content: center;">
     <div>
        <div style="display: flex;justify-content: center;">
         
          <audio controls="controls" tabindex="0" preload="none" id="testTone" preload="metadata" controlsList="nodownload" > 
                      
          </audio>
        </div>
          <div class="adjustPlayer" style="width:80vw; ">
            <div style="display: flex;justify-content: center;">  
              <input type="radio" id="oneMusic" name="loopType" value="oneMusic">
              <label for="oneMusic">單曲循環</label>
              <input type="radio" id="eachMusic" name="loopType" value="eachMusic" checked="true">
              <label for="eachMusic">全部撥放</label><br>
    
            </div>
            <div style="display: flex;justify-content: center;">
              播放速度
              <a href='#' onclick="speedlow()"><button>慢速</button></a>
              <a href='#' onclick="speednormal()"><button>正常</button></a>
              <a href='#' onclick="speedfast()"><button>快速</button></a>
            </div>
          </div>
          <div style="display: none;">
            {{$title := .Title}} 
            {{with (index .Site.Data .File.TranslationBaseName)}}
            <!-- 播放清單 -->
            <ul id="playlist">    
                {{range $index, $cds := .Cds}}
                    {{$Album := (print "CD" (add $index 1)) }}
                        {{range $index, $element :=.Tracks}}
                            {{$title := (print $Album (add $index 1))}} 
                         <li><a href="{{.Url}}" id="{{$title}}"></a></li>

                    {{end}}
                {{end}}
              </ul>
            {{end}}
            <!-- <ul id="playlist">
              <li class="active"><a href="/mp3s/ReadyGo2-CD2-track01.mp3" id="Track 01">ReadyGo CD2 track01</a></li>
              <li><a href="/mp3s/ReadyGo2-CD2-track02.mp3" id="Track 02">ReadyGo CD2 track02</a></li>
              <li><a href="/mp3s/ReadyGo2-CD2-track03.mp3" id="Track 03">ReadyGo CD2 track03</a></li>
              <li><a href="/mp3s/ReadyGo2-CD2-track04.mp3" id="Track 04">ReadyGo CD2 track04</a></li>
              <li><a href="/mp3s/ReadyGo2-CD2-track05.mp3" id="Track 05">ReadyGo CD2 track05</a></li>
            </ul> -->
          </div>
         
        </div>
      
      </div>
      
    </header> 
    
   
  
    <section class="main">

     


     {{$title := .Title}} 
     {{with (index .Site.Data .File.TranslationBaseName)}}
          {{$prefix := .urlPrefix}}
          <!-- {{$publication := .publication}} -->
          {{range $index, $cds := .Cds}}
               {{$Album := (print "CD" (add $index 1)) }}
               <h2 style="background-color: brown; color: white">{{.Album}}</h2>
               {{range $index, $element :=.Tracks}}
                     {{$title := (print $Album (add $index 1))}} 
                        <!-- <p>{{ $title }}</p>                       -->
                     <div class="{{.Title}}" style="display: flex;justify-content: center;">                           
                       <img src="/images/icon_note_g.svg" alt="" style="width: 15px;padding-right: 10px;"> 
                       <a onclick="mySong(this)" class="trackExpression" style="text-decoration: none;color: rgb(119,119,119);display: flex;justify-content: center;" name='{{$title}}' ><h3 >{{print "Track" " " $index}}</h3> <p style="color: #ffffff;margin-left: 20px;background-color: rgb(169, 223, 236);border-radius: 10%;width: 80px;display: flex;justify-content: center;align-items: center;">{{.Duration}}</p></a>
                       <!-- <a onclick="mySong(this)" class="trackExpression" style="text-decoration: none;color: rgb(119,119,119);display: flex;justify-content: center;" name='{{.Title}}' id="{{.Url}}_{{.Title}}"><h3 >{{print "Track" $index}}</h3> <p style="color: #ffffff;margin-left: 20px;background-color: rgb(169, 223, 236);border-radius: 10%;width: 80px;display: flex;justify-content: center;align-items: center;">{{.Duration}}</p></a> -->
                     </div>       
                                        
               {{end}}
          {{end}}
     {{end}}
     <h3>{{$title}}</h3>

    </section>

    <footer></footer>
    {{ partial "footer" . }}

    
    <script>
   //播放速度慢中快
      function speedlow(){
        var myaudio = document.getElementById('testTone');
          console.log(myaudio);
          myaudio.playbackRate = 0.5;
          console.log('myaudio.playbackRate = 0.5;')
   
      }

      function speednormal(){
        var myaudio = document.getElementById('testTone');
          console.log(myaudio);
          myaudio.playbackRate = 1.0;
          console.log('myaudio.playbackRate = 1.0;')
      }
  
      function speedfast(){
        var myaudio = document.getElementById('testTone');
          console.log(myaudio);
          myaudio.playbackRate = 1.5;
          console.log('myaudio.playbackRate = 1.5;')
      }

         function mySong(e){
         var trackExpression= document.querySelectorAll('.trackExpression');//選取出陣列     
         for(var i=0; i<trackExpression.length; i++){
          trackExpression[i].style.color = 'rgb(119,119,119)'; 

          //挑選出每個track的名稱  選擇片段  當作其h3的class       
          var eachTrackTitle= trackExpression[i].getAttribute('name');         
          
          trackExpression[i].firstChild.classList.add(eachTrackTitle);
          trackExpression[i].lastChild.classList.add(eachTrackTitle);
          }
          //為使用者所選擇的track  title上色
         e.style.color='rgb(72,118,175)';    
         
         //觸發其click事件
         document.getElementById(e.getAttribute('name')).click();
      
        }

    

      $(function(){         
   
     
          var audio;
          var playlist;
          var tracks;
          var current;

          init();
          function init(){
            console.log("網頁載入就進來");//只有進來一次
              current = 0;
              audio = $('audio');           
              playlist = $('#playlist');            
              tracks = playlist.find('li a'); //尋找隱藏起來的playlisy 裡面的li a  
              len = tracks.length;           
              audio[0].volume = 0.5;//音量大小
              audio[0].play();  //目前  一開始audio裡面沒有歌曲          
              playlist.find('a').click(function(e){  //第一次 就把所有的a 都加入了click事件
                  e.preventDefault();              
                  link = $(this); // <a> 標籤
                  current = link.parent().index(); //li 的index
                  console.log(' current = link.parent().index(); =', current); //一開始預設是第0個 <li>
                  run(link, audio[0]); //執行<a>標籤裡 href的mp3  
              });
              audio[0].addEventListener('ended',function(e){
                var val=$('input:radio[name="loopType"]:checked').val();
                console.log("事件已經先監聽嗎?")//沒有
                console.log('audio[0]=',audio[0]);//此時audio[0]已經換成下一首了 (why???!)????????
                console.log('current= ',current); //current 還沒換
                if(val=="eachMusic"){ //選擇全部撥放
                  current++;             
                  if(current == len){  //放到最後一首  就回到第一首開始放
                      current = 0;
                      link = playlist.find('a')[0];
                  }else{
                      link = playlist.find('a')[current];                   
                  }
                }
                else{    //選擇單曲循環
                  link = playlist.find('a')[current]; 
                }
                  run($(link),audio[0]);  //why 這裡的link要加$()??  而且不加會無法執行
              });
          }
   
          function run(link, player){        
           player.src = link.attr('href'); //直接把mp3連結 加到 audio的src屬性     
         
           par = link.parent(); // 抓到<li>
           par.addClass('active').siblings().removeClass('active'); //把目前撥放的<li> 增加active class   //其他的siblings移除active class
           //audio[0].load();          
       
           audio[0].play();
        
           currentTrack(link.attr('id'));
          }
     
         
        });
        //目前播放的音軌  hightlight 其background
        function currentTrack(stringArray){
            // var stringArr=stringArray.split(" ");
            // stringArr.slice(3,4)[0];
            // stringArr.slice(-1)[0].slice(0,2);     
            var allTracks=document.querySelectorAll('h3');
            for(var i=0; i<allTracks.length; i++){
              allTracks[i].style.backgroundColor="#FFFFFF";
              allTracks[i].parentNode.parentNode.style.backgroundColor="#FFFFFF";
              allTracks[i].parentNode.parentNode.firstElementChild.src="/images/icon_note_g.svg";
            }
            var allTracksduration=document.querySelectorAll('p');
            for(var i=0; i<allTracksduration.length; i++){
              allTracksduration[i].style.backgroundColor=" rgb(169, 223, 236)";
              allTracksduration[i].style.color="#ffffff"
        
            }
            var theTrack = document.getElementsByClassName(stringArray);
            console.log(theTrack[0]);
            theTrack[0].style.backgroundColor="#FFFFCE";             
            theTrack[0].parentNode.parentNode.style.backgroundColor="#FFFFCE";
            console.log(theTrack[0].parentNode.previousSibling);
            theTrack[0].parentNode.parentNode.firstElementChild.src="/images/icon_note.svg";
  
            // theTrack[1].style.backgroundColor="#97CBFF";  //先不單獨改duration的背景色
            // theTrack[1].style.color="#007979"       
        
          }
    </script>


</body>
</html>
