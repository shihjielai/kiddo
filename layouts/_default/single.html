<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@700&display=swap" rel="stylesheet">
    <style type="text/css">
    
    .header-nav {
        /* background-image: url("/images/top_bg.png"); */
        background-repeat: no-repeat;
        background-color: rgb(96, 221, 240);
        background-position: right;
        overflow: hidden;
        margin: 0 auto;
        width: 1040px;
        height: 180px;
        border-radius: 8px;
        /* height: auto; */
    }
    .header-player {
        background-color: rgb(248,248,255);
    }
 

    section.main{
        height:100px;
        /* background-color:#e4e4e4;   */
        flex-grow:1;  /*充滿剩餘的空間*/
        overflow-y: auto;
        margin: 0px auto;
        /* overflow-y: hidden; */
    }

    footer {
        height: 8%;
        background-color: rgb(59, 125, 185);
        box-shadow:2px 2px 5px cadetblue;
        margin: 0 auto;
        width: 995px;
    }
    body {
        display: flex;
        flex-direction: column;
        margin:0;
        height:100vh;
        font-family: 'Noto Sans JP', sans-serif;
    }
    .paper {
        padding:2rem;
        background-color: white;
        margin:1em;
        box-shadow: 2px 2px 5px grey;
        margin: 0px auto;
    }
    .cdPages {
     display: flex;
     justify-content:flex-start;
     height: 50px;
     background-color: #ffffff;
     padding-top: 20px;
     padding-bottom: 20px;
     /* width: 992px; */
    }
    #CD1 {
        width: 25%;
        background-color:#D5E2EE;
        display: flex;
        justify-content: center;
        align-items:center;
        color:#ffffff;
        font-size: 25px;
        /* margin-left:15px; */
        border-radius: 8px 8px 0px 0px;
        /* box-shadow:2px 2px 2px rgb(177, 196, 173); */
    }
    #CD2 {
        width: 25%;
        background-color:#D5E2EE;
        display: flex;
        justify-content: center;
        align-items:center;
        color:#ffffff;
        font-size: 25px;
        margin-left:15px;
        border-radius: 8px 8px 0px 0px;
        /* box-shadow:2px 2px 2px rgb(177, 196, 173); */
    }
    .header-player {
        display: flex;
        justify-content: center;
        align-items: center;
        margin: 0px auto;
    }
    #eng {
        width: 108px;
        height: 28px;
        letter-spacing: 2px;
        background-color: #f19700;
        display: inline-block;
        margin-left: 30px;
        border-radius: 18px;
        text-align: center;
        color: #ffffff;
        position: relative;
        top: -140px;
    }
    #volume {
        /* letter-spacing: 2px; */
        /* background-color: #f19700; */
        /* display: inline-block; */
        margin-left: 200px;
        /* text-align: center; */
        color: #ffffff;
        position: relative;
        top: -150px;
        font-weight: bolder;
        font-size: 30px;
    }
    .warning {
      display: inline-block;
      margin-left: 160px;
      top: -200px;
      position: relative;
      font-size: 12px;
      color: rgb(246, 252, 253);
      /* font-weight: 400; */
    }
    @media (min-width: 1199px) and (max-width: 4096px){
      header.header-player{
        width: 992px;
      }
      #CD1, #CD2{
        width: 116px;
      }
      section.paper, section.main {
        width: 992px;
      }
      .header-nav {
        width: 992px;
      }
      footer {
        width: 992px;
      }
      .cdPages{
        width: 992px;
      }
      #top_bg {
        transform: scale(1.2);
        padding-top: 13px;
        padding-right: 30px;
      }
      #ReadyGo3 {
        padding-left: 15px;
        transform: scale(0.89);
      }
      #volume {
        margin-left: 200px;
        top: -157px;
      }
      .warning {
        margin-left: 200px;
        top: -175px;
      }
      #eng {
        margin-left: 50px;
      }

    }
    @media screen and (max-width: 1199px){
      header.header-player{
        width: 930px;
      }
      #CD1, #CD2{
        width: 116px;
      }
      section.paper, section.main {
        width: 930px;
      }
      .header-nav {
        width: 930px;
      }
      footer {
        width: 930px;
      }
      .cdPages{
        width: 930px;
      }
      #ReadyGo3 {
        padding-left: 15px;
        transform: scale(0.89);
      }
      #volume {
        margin-left: 200px;
        top: -155px;
      }
      .warning {
        margin-left: 200px;
        top: -175px;
      }
      #eng {
        margin-left: 50px;
      }
    }
    @media screen and (max-width: 991px){
      header.header-player{
        width: 768px;
      }
      #CD1, #CD2{
        width: 116px;
      }
      section.paper, section.main {
        width: 768px;
      }
      .header-nav {
        width: 768px;
      }
      footer {
        width: 768px;
      }
      .cdPages{
        width: 768px;
      }
      #ReadyGo3 {
        padding-left: 15px;
        transform: scale(0.89);
      }
      #eng{
        margin-left: 30px;
        /* top: -165px; */
      }
      #volume {
        margin-left: 180px;
        top: -155px;
      }
      .warning {
        margin-left: 180px;
        top: -175px;
      }
    }
    @media screen and (max-width: 767px){
      header.header-player {
        width: 576px;
      }
      #CD1, #CD2{
        width: 116px;
      }
      section.paper, section.main {
        width: 576px;
      }
      .header-nav {
        width: 576px;
      }
      footer {
        width: 576px;
      }
      .cdPages{
        width: 576px;
      }
      #ReadyGo3 {
        padding-left: 15px;
        transform: scale(0.89);
      }
      #eng {
        margin-left: 180px;
        top: -165px;
      }
      #volume {
        margin-left: 180px;
        top: -175px;
      }
      #top_bg {
        transform: scale(0.3);
        padding-top: 13px;
        padding-right: 10px;
      }
      .warning {
        display: none;
      }
    }
    @media screen and (max-width: 518px){
      header.header-player{
        width: 500px;
      }
      #CD1, #CD2{
        width: 116px;
      }
      section.paper, section.main {
        width: 500px;
      }
      .header-nav {
        width: 500px;
      }
      footer {
        width: 500px;
      }
      .cdPages{
        width: 500px;
      }
      #top_bg {
        transform: scale(0.3);
        padding-top: 13px;
        padding-right: 10px;
      }
      #ReadyGo3 {
        padding-left: 15px;
        margin-top: -3px;
        transform: scale(0.9);
      }
      #eng {
        margin-left: 170px;
        top: -170px;
      }
      #volume {
        margin-left: 170px;
        top: -190px;
      }
      .warning {
        display: none;
      }
    }

    #CD1:hover, #CD2:hover {
      background-color: #f19700;
      cursor: pointer;
    }

    #CD1.active, #CD2.active {
      background-color: #f19700;
    } 

    </style>
</head>
<body>
    <header class="header-nav">
      <!-- <h3>Rock</h3> -->
      <!-- {{with (index .Site.Data .File.TranslationBaseName)}}
        <img src="{{.VolumeImage}}" alt="" style="width: 20%;">
      {{end}} -->

    
      <img id="top_bg" src="/images/top_bg.png" style="float: right; transform: scale(1.599); height: auto;">
      {{with (index .Site.Data .File.TranslationBaseName)}}
      <img src="{{.VolumeImage}}" id="ReadyGo3" alt="" style="height: 100%; overflow: hidden;">
      {{end}}
      
      <div id="eng">國小英語</div> 
      
      <div id="volume">{{with (index .Site.Data .File.TranslationBaseName)}} {{.Volume}} {{end}}</div>
      
      <div class="warning">本網頁提供之音檔僅限購買翰林CD光碟或學用電子書光碟者使用，維護年限為一學年。</div>
      <div class="warning">不得在網路上以任何形式進行公開傳播或下載，違者必究。</div>
      
    </header>
    <div class="cdPages" style="margin: 0px auto">
        <div id="CD1" class="active">CD1</div>
        <div id="CD2">CD2</div>
    </div>
  
    <header class="header-player" style="display: inline-block;justify-content: center;">
      <div>
         <div style="display: flex;justify-content: center;">
          
           <audio controls="controls" tabindex="0" preload="none" id="testTone" preload="metadata" controlsList="nodownload" > 
                       
           </audio>
         </div>
           <div class="adjustPlayer" style="width:80vw; ">
             <div style="display: flex;justify-content: center;">  
               <input type="radio" id="oneMusic" name="loopType" value="oneMusic">
               <label for="oneMusic">單曲循環</label>
               <input type="radio" id="eachMusic" name="loopType" value="eachMusic" checked="true">
               <label for="eachMusic">全部撥放</label><br>
     
             </div>
             <div style="display: flex;justify-content: center;">
               播放速度
               <a href='#' onclick="speedlow()"><button>慢速</button></a>
               <a href='#' onclick="speednormal()"><button>正常</button></a>
               <a href='#' onclick="speedfast()"><button>快速</button></a>
             </div>
           </div>
           <div style="display: none;">
             {{$title := .Title}} 
             {{with (index .Site.Data .File.TranslationBaseName)}}
             <!-- 播放清單 -->
             <ul id="playlist">    
                 {{range $index, $cds := .Cds}}
                     {{$Album := (print "CD" (add $index 1)) }}
                         {{range $index, $element :=.Tracks}}
                             {{$title := (print $Album (add $index 1))}} 
                          <li><a href="{{.Url}}" id="{{$title}}"></a></li>
 
                     {{end}}
                 {{end}}
               </ul>
             {{end}}
             <!-- <ul id="playlist">
               <li class="active"><a href="/mp3s/ReadyGo2-CD2-track01.mp3" id="Track 01">ReadyGo CD2 track01</a></li>
               <li><a href="/mp3s/ReadyGo2-CD2-track02.mp3" id="Track 02">ReadyGo CD2 track02</a></li>
               <li><a href="/mp3s/ReadyGo2-CD2-track03.mp3" id="Track 03">ReadyGo CD2 track03</a></li>
               <li><a href="/mp3s/ReadyGo2-CD2-track04.mp3" id="Track 04">ReadyGo CD2 track04</a></li>
               <li><a href="/mp3s/ReadyGo2-CD2-track05.mp3" id="Track 05">ReadyGo CD2 track05</a></li>
             </ul> -->
           </div>
          
         </div>
       
       </div>
       
     </header> 
     <section class="main">

     


      {{$title := .Title}} 
      {{with (index .Site.Data .File.TranslationBaseName)}}
           {{$prefix := .urlPrefix}}
           <!-- {{$publication := .publication}} -->
           {{range $index, $cds := .Cds}}
                {{$Album := (print "CD" (add $index 1)) }}
                <!-- <h2 style="background-color: brown; color: white">{{.cd}}</h2> -->
                 <div id="tab-{{$Album}}">
                {{range $index, $element :=.Tracks}}
                      {{$title := (print $Album (add $index 1))}} 
                     
                      <div class="{{.Title}}" style="display: flex;justify-content: center;">                           
                        <img src="/images/icon_note_g.svg" alt="" style="width: 15px;padding-right: 10px;"> 
                        <a onclick="mySong(this)" class="trackExpression" style="text-decoration: none;color: rgb(119,119,119);display: flex;justify-content: center;" name='{{$title}}' ><h3 >{{print "Track" " " (add $index 1)}}</h3> <p style="color: #ffffff;margin-left: 20px;background-color: rgb(169, 223, 236);border-radius: 10%;width: 80px;display: flex;justify-content: center;align-items: center;">{{.Duration}}</p></a>
                      
                      </div>       
                                 
                {{end}}
              </div>
           {{end}}
      {{end}}
  
 
     </section>

    <footer style="height: 60px;"></footer>
    {{ partial "footer" . }}

    <script>

function speedlow(){
        var myaudio = document.getElementById('testTone');
          console.log(myaudio);
          myaudio.playbackRate = 0.5;
          console.log('myaudio.playbackRate = 0.5;')
   
      }

      function speednormal(){
        var myaudio = document.getElementById('testTone');
          console.log(myaudio);
          myaudio.playbackRate = 1.0;
          console.log('myaudio.playbackRate = 1.0;')
      }
  
      function speedfast(){
        var myaudio = document.getElementById('testTone');
          console.log(myaudio);
          myaudio.playbackRate = 1.5;
          console.log('myaudio.playbackRate = 1.5;')
      }

         function mySong(e){
         var trackExpression= document.querySelectorAll('.trackExpression');//選取出陣列     
         for(var i=0; i<trackExpression.length; i++){
          trackExpression[i].style.color = 'rgb(119,119,119)'; 

          //挑選出每個track的名稱  選擇片段  當作其h3的class       
          var eachTrackTitle= trackExpression[i].getAttribute('name');         
          
          trackExpression[i].firstChild.classList.add(eachTrackTitle);
          trackExpression[i].lastChild.classList.add(eachTrackTitle);
          }
          //為使用者所選擇的track  title上色
         e.style.color='rgb(72,118,175)';    
         
         //觸發其click事件
         document.getElementById(e.getAttribute('name')).click();
      
        }

      $(function(){
        hideCD(2);

        function hideCD(tabIndex) { 
        trackDiv = document.getElementById(`tab-CD${tabIndex}`);
        trackDiv.style.display = "none";
        }

        function showCD(tabIndex) { 
          trackDiv = document.getElementById(`tab-CD${tabIndex}`);
          trackDiv.style.display = "block";
          trackDiv.style.visibility = "visible";
        }

        $("#CD1").click(function(){
          $(this).siblings().removeClass("active");
          $(this).addClass("active");
          hideCD(2);
          showCD(1);
        })

        $("#CD2").click(function(){
          $(this).siblings().removeClass("active");
          $(this).addClass("active");
          hideCD(1);
          showCD(2);
        })

        var audio;
          var playlist;
          var tracks;
          var current;

          init();
          function init(){
            console.log("網頁載入就進來");//只有進來一次
              current = 0;
              audio = $('audio');           
              playlist = $('#playlist');            
              tracks = playlist.find('li a'); //尋找隱藏起來的playlisy 裡面的li a  
              len = tracks.length;           
              audio[0].volume = 0.5;//音量大小
              audio[0].play();  //目前  一開始audio裡面沒有歌曲          
              playlist.find('a').click(function(e){  //第一次 就把所有的a 都加入了click事件
                  e.preventDefault();              
                  link = $(this); // <a> 標籤
                  current = link.parent().index(); //li 的index
                  console.log(' current = link.parent().index(); =', current); //一開始預設是第0個 <li>
                  run(link, audio[0]); //執行<a>標籤裡 href的mp3  
              });
              audio[0].addEventListener('ended',function(e){
                var val=$('input:radio[name="loopType"]:checked').val();
                console.log("事件已經先監聽嗎?")//沒有
                console.log('audio[0]=',audio[0]);//此時audio[0]已經換成下一首了 (why???!)????????
                console.log('current= ',current); //current 還沒換
                if(val=="eachMusic"){ //選擇全部撥放
                  current++;             
                  if(current == len){  //放到最後一首  就回到第一首開始放
                      current = 0;
                      link = playlist.find('a')[0];
                  }else{
                      link = playlist.find('a')[current];                   
                  }
                }
                else{    //選擇單曲循環
                  link = playlist.find('a')[current]; 
                }
                  run($(link),audio[0]);  //why 這裡的link要加$()??  而且不加會無法執行
              });
          }
   
          function run(link, player){        
           player.src = link.attr('href'); //直接把mp3連結 加到 audio的src屬性     
         
           par = link.parent(); // 抓到<li>
           par.addClass('active').siblings().removeClass('active'); //把目前撥放的<li> 增加active class   //其他的siblings移除active class
           //audio[0].load();          
       
           audio[0].play();
        
           currentTrack(link.attr('id'));
          }
     
      });

             //目前播放的音軌  hightlight 其background
             function currentTrack(stringArray){
            // var stringArr=stringArray.split(" ");
            // stringArr.slice(3,4)[0];
            // stringArr.slice(-1)[0].slice(0,2);     
            var allTracks=document.querySelectorAll('h3');
            for(var i=0; i<allTracks.length; i++){
              allTracks[i].style.backgroundColor="#FFFFFF";
              allTracks[i].parentNode.parentNode.style.backgroundColor="#FFFFFF";
              allTracks[i].parentNode.parentNode.firstElementChild.src="/images/icon_note_g.svg";
            }
            var allTracksduration=document.querySelectorAll('p');
            for(var i=0; i<allTracksduration.length; i++){
              allTracksduration[i].style.backgroundColor=" rgb(169, 223, 236)";
              allTracksduration[i].style.color="#ffffff"
        
            }
            var theTrack = document.getElementsByClassName(stringArray);
            console.log(theTrack[0]);
            theTrack[0].style.backgroundColor="#FFFFCE";             
            theTrack[0].parentNode.parentNode.style.backgroundColor="#FFFFCE";
            console.log(theTrack[0].parentNode.previousSibling);
            theTrack[0].parentNode.parentNode.firstElementChild.src="/images/icon_note.svg";
  
            // theTrack[1].style.backgroundColor="#97CBFF";  //先不單獨改duration的背景色
            // theTrack[1].style.color="#007979"       
        
          }
    </script>

</body>
</html>

